---
title: '/reply-review-comments'
description: 'プッシュ後にレビューコメントに対応済みの返信を残す。修正内容を説明するコメントを自動生成して投稿する。'
---

あなたはプッシュ後にレビューコメントに返信を残すアシスタントです。以下のルールで、対応済みのレビューコメントに対して修正内容を説明するコメントを自動的に投稿してください。

## 目的

- プッシュ後にレビューコメントに対応済みの返信を残す
- レビュワーが修正内容を理解できるよう、具体的な修正方法を説明する
- 意図的に修正していない場合は、その理由を説明する

## 実行タイミング

- プッシュ後（`git push` 実行後）に実行
- ユーザーが明示的に `/reply-review-comments` コマンドを実行した時

## ワークフロー

### 0. プッシュの確認と実行（必須）

**⚠️ 重要: このコマンドを実行する前に、必ずプッシュを完了してください。**

```bash
# プッシュされていないコミットがあるか確認
git log --oneline origin/$(git branch --show-current)..HEAD

# プッシュされていないコミットがある場合、プッシュを実行
if [ $(git log --oneline origin/$(git branch --show-current)..HEAD | wc -l) -gt 0 ]; then
  echo "⚠️ プッシュされていないコミットがあります。まずプッシュを実行してください。"
  echo "実行コマンド: git push"
  exit 1
fi
```

**プッシュされていないコミットがある場合は、ユーザーにプッシュを促し、プッシュ完了後に再度このコマンドを実行するように指示してください。**

### 1. 現在のブランチとPR情報を取得

```bash
# 現在のブランチ名を取得
git branch --show-current

# PR番号を取得（ブランチ名から抽出、または gh pr view で確認）
gh pr view --json number,url
```

### 2. レビューコメントを取得

```bash
# 最新のレビューコメントを取得
gh api repos/{owner}/{repo}/pulls/{PR_NUMBER}/comments --jq 'sort_by(.created_at) | reverse | .[] | {id: .id, author: .user.login, body: .body[0:500], path: .path, line: .line, createdAt: .created_at}'

# 特定のレビューに含まれるコメントを取得
gh api repos/{owner}/{repo}/pulls/{PR_NUMBER}/reviews/{REVIEW_ID}/comments --jq '.[] | {id: .id, path: .path, line: .line, body: .body[0:500]}'
```

### 3. 対応状況の確認

各レビューコメントについて、以下を確認：

1. **ファイルが存在するか確認**

   ```bash
   git diff HEAD~1 HEAD -- {file_path}
   ```

2. **修正内容を確認**
   - 指摘された行が修正されているか
   - 修正方法が適切か
   - 意図的に修正していない場合は理由があるか

### 4. コメント返信の作成

対応済みのコメントに対して、以下の形式で返信を作成：

#### 修正した場合

```
✅ 対応しました。

修正内容：
- [具体的な修正内容を説明]
- [変更した行番号やファイル名]
- [修正により解決された問題]
```

#### 意図的に修正していない場合

```
意図的に修正していません。

理由：
- [修正しない理由を説明]
- [代替案や今後の対応予定があれば記載]
```

### 5. コメント返信の投稿

```bash
# レビューコメントに返信を投稿
gh api repos/{owner}/{repo}/pulls/{PR_NUMBER}/comments/{COMMENT_ID}/replies -X POST -f body='{返信内容}'
```

## コメント返信の例

### 例1: 修正済みの場合

```markdown
✅ 対応しました。

修正内容：

- `error.error || error.message` の順序でエラーメッセージを取得するように変更しました（241行目）
- APIが返す `{ error: '...', details: ... }` 形式に対応し、サーバー側のエラーメッセージを正しく表示できるようになりました
```

### 例2: セキュリティ修正の場合

```markdown
✅ 対応しました（Criticalセキュリティ脆弱性を修正）。

修正内容：

- `generateStateToken()` 関数を追加し、HMAC-SHA256を使用した署名付きstateトークンを生成するように変更しました
- `verifyStateToken()` 関数を追加し、callbackでstateトークンの署名と有効期限（30分）を検証するようにしました
- stateパラメータに平文の `userId` を設定するのではなく、`userId:nonce:timestamp:signature` 形式の署名付きトークンを使用するようにしました
- これにより、CSRF攻撃によるアカウント乗っ取りの脆弱性を解消しました

セキュリティ改善：

- 署名検証により、トークンの改ざんを防止
- タイムスタンプによる有効期限チェック（30分）
- ランダムなnonceによるリプレイ攻撃の軽減
```

### 例3: 意図的に修正していない場合

```markdown
意図的に修正していません。

理由：

- この実装は意図的な設計であり、全員がお問い合わせを確認・更新できる状態が望ましいため
- コメントは「お問い合わせ一覧（管理者のみ）」となっていますが、実際の仕様は「全ユーザー」が正しい
- コメントの修正のみ対応済み
```

## 注意事項

1. **重複返信の回避**
   - 既に返信が存在するコメントには再度返信しない
   - 返信前に既存の返信を確認する

2. **正確性の確保**
   - 修正内容を正確に説明する
   - 行番号やファイル名は実際の変更に基づく

3. **簡潔性**
   - 返信は簡潔に、要点を明確に
   - 長すぎる説明は避ける

4. **プライバシー**
   - 機密情報やトークンを含めない
   - 環境変数名は記載しても値は記載しない

## 完了チェックリスト

- [ ] プッシュされていないコミットがないことを確認（またはプッシュを実行）
- [ ] 現在のブランチからPR番号を取得
- [ ] レビューコメントを全て取得
- [ ] 各コメントの対応状況を確認
- [ ] 対応済みのコメントに返信を投稿
- [ ] 返信内容が正確で簡潔であることを確認
