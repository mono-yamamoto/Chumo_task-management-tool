# GCP Secret Manager コスト試算

## GCP Secret Managerの料金構造

### 無料枠

- **アクティブなシークレットバージョン**: 月6つまで無料
- **アクセスオペレーション**: 月10,000回まで無料

### 超過時の料金

- **アクティブなシークレットバージョン**: 1つあたり月$0.06（6つを超えた場合）
- **アクセスオペレーション**: 10,000回ごとに$0.03（10,000回を超えた場合）

---

## このプロジェクトでの使用状況

### Secretsの数

全部で**5つのSecrets**を使用：

1. `MAKE_WEBHOOK_SECRET`
2. `DRIVE_PARENT_ID`
3. `CHECKSHEET_TEMPLATE_ID`
4. `GITHUB_TOKEN`
5. `DRIVE_SERVICE_ACCOUNT_KEY`

**アクティブなシークレットバージョン**: 5つ（無料枠の6つ以内 ✅）

### アクセス頻度の推定

#### 各FunctionでのSecret取得回数

| Function名          | 取得するSecrets                                                        | 1回の実行あたりのアクセス数 |
| ------------------- | ---------------------------------------------------------------------- | --------------------------- |
| `createDriveFolder` | DRIVE_SERVICE_ACCOUNT_KEY<br>DRIVE_PARENT_ID<br>CHECKSHEET_TEMPLATE_ID | 3回                         |
| `createFireIssue`   | GITHUB_TOKEN                                                           | 1回                         |
| `syncBacklog`       | MAKE_WEBHOOK_SECRET                                                    | 1回（現在コメントアウト）   |

#### 使用頻度の想定シナリオ

**シナリオ1: 小規模チーム（3-5人）**

- Driveフォルダ作成: 1日5回 × 30日 = **150回/月**
- GitHub Issue作成: 1日2回 × 30日 = **60回/月**
- Backlog同期: 1日10回 × 30日 = **300回/月**（Make経由）

**合計アクセス数**:

- `createDriveFolder`: 150回 × 3 = **450回**
- `createFireIssue`: 60回 × 1 = **60回**
- `syncBacklog`: 300回 × 1 = **300回**
- **合計: 810回/月** ✅ 無料枠内

---

**シナリオ2: 中規模チーム（10-20人）**

- Driveフォルダ作成: 1日20回 × 30日 = **600回/月**
- GitHub Issue作成: 1日10回 × 30日 = **300回/月**
- Backlog同期: 1日50回 × 30日 = **1,500回/月**

**合計アクセス数**:

- `createDriveFolder`: 600回 × 3 = **1,800回**
- `createFireIssue`: 300回 × 1 = **300回**
- `syncBacklog`: 1,500回 × 1 = **1,500回**
- **合計: 3,600回/月** ✅ 無料枠内

---

**シナリオ3: 大規模チーム（50人以上）**

- Driveフォルダ作成: 1日100回 × 30日 = **3,000回/月**
- GitHub Issue作成: 1日50回 × 30日 = **1,500回/月**
- Backlog同期: 1日200回 × 30日 = **6,000回/月**

**合計アクセス数**:

- `createDriveFolder`: 3,000回 × 3 = **9,000回**
- `createFireIssue`: 1,500回 × 1 = **1,500回**
- `syncBacklog`: 6,000回 × 1 = **6,000回**
- **合計: 16,500回/月**

**超過分**: 16,500 - 10,000 = **6,500回**
**料金**: 6,500 ÷ 10,000 × $0.03 = **$0.0195/月**（約3円）

---

**シナリオ4: 非常に大規模（100人以上、1日500回以上のBacklog同期）**

- Driveフォルダ作成: 1日200回 × 30日 = **6,000回/月**
- GitHub Issue作成: 1日100回 × 30日 = **3,000回/月**
- Backlog同期: 1日500回 × 30日 = **15,000回/月**

**合計アクセス数**:

- `createDriveFolder`: 6,000回 × 3 = **18,000回**
- `createFireIssue`: 3,000回 × 1 = **3,000回**
- `syncBacklog`: 15,000回 × 1 = **15,000回**
- **合計: 36,000回/月**

**超過分**: 36,000 - 10,000 = **26,000回**
**料金**: 26,000 ÷ 10,000 × $0.03 = **$0.078/月**（約12円）

---

## コスト試算まとめ

| シナリオ                  | 月間アクセス数 | 無料枠内？ | 月額コスト          |
| ------------------------- | -------------- | ---------- | ------------------- |
| 小規模（3-5人）           | 810回          | ✅ はい    | **$0（無料）**      |
| 中規模（10-20人）         | 3,600回        | ✅ はい    | **$0（無料）**      |
| 大規模（50人以上）        | 16,500回       | ❌ いいえ  | **$0.02（約3円）**  |
| 非常に大規模（100人以上） | 36,000回       | ❌ いいえ  | **$0.08（約12円）** |

---

## 結論

### すべてGCP Secret Managerを使った場合のコスト

**ほとんどの場合、無料で使用できます！**

- **小規模〜中規模チーム**: **完全無料**（月10,000回まで無料）
- **大規模チーム**: **月3円程度**（非常に安い）
- **非常に大規模**: **月12円程度**（それでも非常に安い）

### アクティブなシークレットバージョン

- 5つのSecretsを使用 → **無料枠の6つ以内** ✅
- 追加コストなし

### 実質的なコスト

**個人〜小規模チーム向けのタスク管理ツールであれば、ほぼ確実に無料で使用できます。**

月10,000回のアクセスは、1日あたり約333回に相当します。通常の使用では、この上限を超えることはほとんどありません。

---

## 参考：他のGCPサービスのコスト比較

- **Firestore**: 読み取り50,000回/日まで無料、その後$0.06/100,000回
- **Cloud Functions**: 200万回/月まで無料、その後$0.40/100万回
- **Secret Manager**: 10,000回/月まで無料、その後$0.03/10,000回

**Secret Managerは最も無料枠が大きいサービスです。**

---

## 推奨

**すべてGCP Secret Managerを使うことを強く推奨します。**

理由：

1. ✅ **コストがほぼゼロ**（個人〜中規模チームは完全無料）
2. ✅ **セキュリティが高い**
3. ✅ **管理が簡単**
4. ✅ **JSON形式のサービスアカウントキーも扱いやすい**

環境変数と併用する必要はありません。すべてSecret Managerで統一する方が管理が簡単です。
